#
# This file is auto-generated. DO NOT EDIT
# Generated by: autospec.py
#
Name     : SuiteSparse
Version  : 6.0.3
Release  : 46
URL      : https://github.com/DrTimothyAldenDavis/SuiteSparse/archive/v6.0.3/SuiteSparse-6.0.3.tar.gz
Source0  : https://github.com/DrTimothyAldenDavis/SuiteSparse/archive/v6.0.3/SuiteSparse-6.0.3.tar.gz
Summary  : No detailed summary available
Group    : Development/Tools
License  : Apache-2.0 BSD-2-Clause BSD-3-Clause GPL-2.0 GPL-3.0 LGPL-2.1
BuildRequires : SuiteSparse-dev
BuildRequires : buildreq-cmake
BuildRequires : eigen-dev
BuildRequires : gmp-dev
BuildRequires : metis-dev
BuildRequires : mpfr-dev
BuildRequires : openblas
BuildRequires : tbb-dev
Patch1: build.patch
Patch2: ivdep.patch
Patch3: makefile-metis.patch
Patch4: gnu.patch

%description
SuiteSparse: a suite of sparse matrix packages by T. A. Davis et al.
(This repository contains copies of the official releases.)

%prep
%setup -q -n SuiteSparse-6.0.3
cd %{_builddir}/SuiteSparse-6.0.3
%patch1 -p1
%patch2 -p1
%patch3 -p1
%patch4 -p1
pushd ..
cp -a SuiteSparse-6.0.3 buildavx2
popd
pushd ..
cp -a SuiteSparse-6.0.3 buildavx512
popd

%build
## build_prepend content
find ./metis-5.1.0 ! -name 'LICENSE.txt' -type f -exec rm -f {} +
ln -s %{_includedir}/metis.h include/metis.h
## build_prepend end
export http_proxy=http://127.0.0.1:9/
export https_proxy=http://127.0.0.1:9/
export no_proxy=localhost,127.0.0.1,0.0.0.0
export LANG=C.UTF-8
export SOURCE_DATE_EPOCH=1672163868
export GCC_IGNORE_WERROR=1
export CFLAGS="$CFLAGS -Ofast -falign-functions=32 -fno-lto -fno-semantic-interposition -mprefer-vector-width=512 "
export FCFLAGS="$FFLAGS -Ofast -falign-functions=32 -fno-lto -fno-semantic-interposition -mprefer-vector-width=512 "
export FFLAGS="$FFLAGS -Ofast -falign-functions=32 -fno-lto -fno-semantic-interposition -mprefer-vector-width=512 "
export CXXFLAGS="$CXXFLAGS -Ofast -falign-functions=32 -fno-lto -fno-semantic-interposition -mprefer-vector-width=512 "
make  %{?_smp_mflags}  BLAS=-lopenblas LAPACK=-lopenblas library MY_METIS_LIB=/usr/lib64/libmetis.so CMAKE_OPTIONS="-DCMAKE_INSTALL_BINDIR=/usr/bin -DCMAKE_INSTALL_LIBDIR=/usr/lib64 -DCMAKE_INSTALL_INCLUDEDIR=/usr/include" JOBS=$(nproc)

pushd ../buildavx2
## build_prepend content
find ./metis-5.1.0 ! -name 'LICENSE.txt' -type f -exec rm -f {} +
ln -s %{_includedir}/metis.h include/metis.h
## build_prepend end
export CFLAGS="$CFLAGS -m64 -march=x86-64-v3 -Wl,-z,x86-64-v3"
export CXXFLAGS="$CXXFLAGS -m64 -march=x86-64-v3 -Wl,-z,x86-64-v3"
export FFLAGS="$FFLAGS -m64 -march=x86-64-v3 -Wl,-z,x86-64-v3"
export FCFLAGS="$FCFLAGS -m64 -march=x86-64-v3"
export LDFLAGS="$LDFLAGS -m64 -march=x86-64-v3"
make  %{?_smp_mflags}  BLAS=-lopenblas LAPACK=-lopenblas library MY_METIS_LIB=/usr/lib64/libmetis.so CMAKE_OPTIONS="-DCMAKE_INSTALL_BINDIR=/usr/bin -DCMAKE_INSTALL_LIBDIR=/usr/lib64 -DCMAKE_INSTALL_INCLUDEDIR=/usr/include" JOBS=$(nproc)
popd
pushd ../buildavx512
## build_prepend content
find ./metis-5.1.0 ! -name 'LICENSE.txt' -type f -exec rm -f {} +
ln -s %{_includedir}/metis.h include/metis.h
## build_prepend end
export CFLAGS="$CFLAGS -m64 -march=x86-64-v4 -mprefer-vector-width=256 -Wl,-z,x86-64-v4"
export CXXFLAGS="$CXXFLAGS -m64 -march=x86-64-v4 -mprefer-vector-width=256 -Wl,-z,x86-64-v4"
export FFLAGS="$FFLAGS -m64 -march=x86-64-v4 -mprefer-vector-width=256 -Wl,-z,x86-64-v4"
export FCFLAGS="$FCFLAGS -m64 -march=x86-64-v4 -mprefer-vector-width=256"
export LDFLAGS="$LDFLAGS -m64 -march=x86-64-v4"
make  %{?_smp_mflags}  BLAS=-lopenblas LAPACK=-lopenblas library MY_METIS_LIB=/usr/lib64/libmetis.so CMAKE_OPTIONS="-DCMAKE_INSTALL_BINDIR=/usr/bin -DCMAKE_INSTALL_LIBDIR=/usr/lib64 -DCMAKE_INSTALL_INCLUDEDIR=/usr/include" JOBS=$(nproc)
popd

%install
export SOURCE_DATE_EPOCH=1672163868
rm -rf %{buildroot}
mkdir -p %{buildroot}/usr/share/package-licenses/SuiteSparse
cp %{_builddir}/SuiteSparse-%{version}/BTF/Doc/License.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b13f6d59d5b230774696d884785ec850e6d31bc2
cp %{_builddir}/SuiteSparse-%{version}/CCOLAMD/Doc/License.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/de522c4d6fbb410a79215466e3449a4cb6bdd3ce
cp %{_builddir}/SuiteSparse-%{version}/CHOLMOD/Demo/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/CHOLMOD/MATLAB/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/CHOLMOD/MatrixOps/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/CHOLMOD/Modify/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/CHOLMOD/SuiteSparse_metis/LICENSE.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/a7c3a4f7dcf7a014c7dfdd3f8752d699eb7f7c2e
cp %{_builddir}/SuiteSparse-%{version}/CHOLMOD/Supernodal/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/CHOLMOD/Tcov/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/CHOLMOD/Valgrind/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/CSparse/Doc/License.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/f8fdd046aa7b6df4eb00a0f5a84b0edd23c3b15a
cp %{_builddir}/SuiteSparse-%{version}/CXSparse/Doc/License.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/21951afb2d8cb7f350c28dee727d2009d222301c
cp %{_builddir}/SuiteSparse-%{version}/GPUQREngine/Doc/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/GraphBLAS/CUDA/License.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b8ad93379e28ac7d7fd4f5179d77f5e353e7fb37
cp %{_builddir}/SuiteSparse-%{version}/GraphBLAS/lz4/LICENSE %{buildroot}/usr/share/package-licenses/SuiteSparse/10bf56381baaf07f0647b93a810eb4e7e9545e8d
cp %{_builddir}/SuiteSparse-%{version}/GraphBLAS/zstd/LICENSE %{buildroot}/usr/share/package-licenses/SuiteSparse/c4130945ca3d1f8ea4a3e8af36d3c18b2232116c
cp %{_builddir}/SuiteSparse-%{version}/MATLAB_Tools/Doc/License.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/826aa61f418305257925825e866cf05a9fad5fe6
cp %{_builddir}/SuiteSparse-%{version}/Mongoose/Doc/License.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/8624bcdae55baeef00cd11d5dfcfa60f68710a02
cp %{_builddir}/SuiteSparse-%{version}/RBio/Doc/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/SPEX/SPEX_Left_LU/License/GPLv2.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/4cc77b90af91e615a64ae04893fdffa7939db84c
cp %{_builddir}/SuiteSparse-%{version}/SPEX/SPEX_Util/License/GPLv2.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/4cc77b90af91e615a64ae04893fdffa7939db84c
cp %{_builddir}/SuiteSparse-%{version}/SPQR/Doc/License.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/25d008cc9407fe74e848986127e114e3a5453c83
cp %{_builddir}/SuiteSparse-%{version}/SPQR/Doc/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/SuiteSparse_GPURuntime/Doc/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
cp %{_builddir}/SuiteSparse-%{version}/UMFPACK/Doc/gpl.txt %{buildroot}/usr/share/package-licenses/SuiteSparse/b47456e2c1f38c40346ff00db976a2badf36b5e3
pushd ../buildavx2/
%make_install_v3 BLAS=-lopenblas LAPACK=-lopenblas INSTALL=%{buildroot}/usr  INSTALL_LIB=%{buildroot}/usr/lib64 INSTALL_BIN=%{buildroot}/usr/bin MY_METIS_LIB=/usr/lib64/libmetis.so || :
popd
pushd ../buildavx512/
%make_install_v4 BLAS=-lopenblas LAPACK=-lopenblas INSTALL=%{buildroot}/usr  INSTALL_LIB=%{buildroot}/usr/lib64 INSTALL_BIN=%{buildroot}/usr/bin MY_METIS_LIB=/usr/lib64/libmetis.so || :
popd
%make_install BLAS=-lopenblas LAPACK=-lopenblas INSTALL=%{buildroot}/usr  INSTALL_LIB=%{buildroot}/usr/lib64 INSTALL_BIN=%{buildroot}/usr/bin MY_METIS_LIB=/usr/lib64/libmetis.so || :
## Remove excluded files
rm -f %{buildroot}*/usr/include/.gitignore
## install_append content
mkdir -p %{buildroot}/usr/include
cp -a include/*.{h,hpp} %{buildroot}/usr/include/
rm -f %{buildroot}/usr/include/metis.h
## install_append end
/usr/bin/elf-move.py avx2 %{buildroot}-v3 %{buildroot} %{buildroot}/usr/share/clear/filemap/filemap-%{name}
/usr/bin/elf-move.py avx512 %{buildroot}-v4 %{buildroot} %{buildroot}/usr/share/clear/filemap/filemap-%{name}

%files
%defattr(-,root,root,-)
